<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dhanvantri - Pharmacogenomics Analysis Platform</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="nav-brand">
                <span>Dhanvantri</span>
            </a>
            <div class="nav-menu">
                <a href="#" class="nav-link active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-link" data-section="analysis">
                    <i class="fas fa-microscope"></i>
                    <span>New Analysis</span>
                </a>
                <a href="#" class="nav-link" data-section="reports">
                    <i class="fas fa-file-medical"></i>
                    <span>Reports</span>
                </a>
                <a href="#" class="nav-link" data-section="drugs">
                    <i class="fas fa-pills"></i>
                    <span>Drug Database</span>
                </a>
                <a href="#" class="nav-link" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </div>
            <div class="nav-user">
                <div class="user-avatar"></div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <div class="section-header">
                <h1>Medical Dashboard</h1>
                <p>Comprehensive pharmacogenomics analysis platform for personalized medicine and drug safety</p>
            </div>

            <!-- Statistics Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-content">
                        <div class="stat-icon">
                            <i class="fas fa-file-medical"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-reports">2</h3>
                            <p>Total Reports</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-content">
                        <div class="stat-icon">
                            <i class="fas fa-dna"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-variants">92,622</h3>
                            <p>Variants Analyzed</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-content">
                        <div class="stat-icon">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-drugs">2</h3>
                            <p>Drugs Analyzed</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-content">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="high-risk-interactions">0</h3>
                            <p>High-Risk Interactions</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card mb-12">
                <div class="card-header">
                    <h2 class="card-title">Quick Actions</h2>
                    <p class="card-subtitle">Start new analysis or access existing reports</p>
                </div>
                <div class="card-body">
                    <div class="quick-actions-grid">
                        <div class="action-card" onclick="startNewAnalysis()">
                            <div class="action-icon">
                                <i class="fas fa-plus"></i>
                            </div>
                            <h3 class="action-title">New Analysis</h3>
                            <p class="action-description">Upload VCF file and start pharmacogenomics analysis</p>
                        </div>
                        <div class="action-card" onclick="switchSection('reports')">
                            <div class="action-icon">
                                <i class="fas fa-eye"></i>
                            </div>
                            <h3 class="action-title">View Reports</h3>
                            <p class="action-description">Access and review completed analysis reports</p>
                        </div>
                        <div class="action-card" onclick="switchSection('drugs')">
                            <div class="action-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <h3 class="action-title">Browse Drugs</h3>
                            <p class="action-description">Explore drug database and interactions</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analysis Section -->
        <section id="analysis" class="content-section">
            <div class="section-header">
                <h1>New Pharmacogenomics Analysis</h1>
                <p>Upload your VCF file and select drugs for personalized medical analysis</p>
                <div class="mt-6">
                    <button class="btn btn-secondary btn-lg" onclick="startNewAnalysis()">
                        <i class="fas fa-refresh"></i>
                        Start New Analysis
                    </button>
                </div>
            </div>

            <div class="analysis-container">
                <!-- Step 1: Patient Information -->
                <div id="step-1" class="analysis-step active">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <h2 class="step-title">Patient Information</h2>
                        <p class="step-subtitle">Enter patient details for this analysis</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="patient-id">Patient ID *</label>
                        <input type="text" id="patient-id" class="form-input" placeholder="Enter unique patient identifier" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="patient-name">Patient Name (Optional)</label>
                        <input type="text" id="patient-name" class="form-input" placeholder="Enter patient name">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="analysis-notes">Analysis Notes (Optional)</label>
                        <textarea id="analysis-notes" class="form-textarea" placeholder="Add any relevant notes for this analysis"></textarea>
                    </div>

                    <div class="step-actions">
                        <div></div>
                        <button class="btn btn-primary btn-lg" onclick="nextStep(2)">
                            Next: Upload VCF
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: VCF File Upload -->
                <div id="step-2" class="analysis-step">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <h2 class="step-title">Upload VCF File</h2>
                        <p class="step-subtitle">Upload your genetic variant data file</p>
                    </div>

                    <div class="upload-area" id="vcf-upload-area">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <h3 class="upload-title">Upload VCF File</h3>
                        <p class="upload-subtitle">Drag and drop your VCF file here, or click to browse</p>
                        <input type="file" id="vcf-file" accept=".vcf,.vcf.gz" style="display: none;">
                        <button class="btn btn-secondary btn-lg">Choose File</button>
                    </div>

                    <div id="vcf-file-info" class="card mt-8" style="display: none;">
                        <div class="card-body">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <i class="fas fa-file-alt text-red" style="font-size: 2rem;"></i>
                                    <div>
                                        <h4 id="vcf-filename" class="font-semibold text-lg">filename.vcf</h4>
                                        <p id="vcf-filesize" class="text-secondary">0 MB</p>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline" onclick="removeVcfFile()">
                                    <i class="fas fa-times"></i>
                                    Remove
                                </button>
                            </div>
                            <div id="vcf-validation" class="mt-6 flex items-center gap-3">
                                <i class="fas fa-spinner fa-spin text-red"></i>
                                <span>Validating file...</span>
                            </div>
                        </div>
                    </div>

                    <div class="step-actions">
                        <button class="btn btn-secondary btn-lg" onclick="previousStep(1)">
                            <i class="fas fa-arrow-left"></i>
                            Previous
                        </button>
                        <button class="btn btn-primary btn-lg" id="vcf-next-btn" onclick="nextStep(3)" disabled>
                            Next: Select Drugs
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Drug Selection -->
                <div id="step-3" class="analysis-step">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <h2 class="step-title">Drug Selection</h2>
                        <p class="step-subtitle">Choose medications for pharmacogenomic analysis</p>
                    </div>

                    <div class="card mb-8">
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Search Drugs</label>
                                <input type="text" id="drug-search" class="form-input" placeholder="Search for drugs...">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Add Custom Drug</label>
                                <div class="flex gap-3">
                                    <input type="text" id="custom-drug-name" class="form-input" placeholder="Enter custom drug name (e.g., Aspirin, Metoprolol)">
                                    <button class="btn btn-primary" id="add-custom-drug-btn" onclick="addCustomDrug()">
                                        <i class="fas fa-plus"></i>
                                        Add
                                    </button>
                                </div>
                                <p class="text-secondary text-sm mt-3">
                                    <i class="fas fa-info-circle"></i>
                                    Add drugs not found in the database. Enter the generic or brand name.
                                </p>
                            </div>

                            <div class="flex gap-3 flex-wrap">
                                <button class="btn btn-sm btn-primary" data-category="all">All Drugs</button>
                                <button class="btn btn-sm btn-outline" data-category="cardiovascular">Cardiovascular</button>
                                <button class="btn btn-sm btn-outline" data-category="psychiatric">Psychiatric</button>
                                <button class="btn btn-sm btn-outline" data-category="oncology">Oncology</button>
                                <button class="btn btn-sm btn-outline" data-category="pain">Pain Management</button>
                                <button class="btn btn-sm btn-outline" data-category="other">Other</button>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Available Drugs</h3>
                            </div>
                            <div class="card-body">
                                <div id="available-drugs" class="space-y-4">
                                    <!-- Available drugs will be populated here -->
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Selected Drugs (<span id="selected-count">0</span>)</h3>
                            </div>
                            <div class="card-body">
                                <div id="selected-drug-list" class="space-y-4">
                                    <!-- Selected drugs will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-actions">
                        <button class="btn btn-secondary btn-lg" onclick="previousStep(2)">
                            <i class="fas fa-arrow-left"></i>
                            Previous
                        </button>
                        <button class="btn btn-primary btn-lg" id="drug-next-btn" onclick="nextStep(4)" disabled>
                            Next: Configure
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 4: Analysis Configuration -->
                <div id="step-4" class="analysis-step">
                    <div class="step-header">
                        <div class="step-number">4</div>
                        <h2 class="step-title">Analysis Configuration</h2>
                        <p class="step-subtitle">Configure analysis options and report settings</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">AI Analysis Options</h3>
                            </div>
                            <div class="card-body">
                                <div class="space-y-6">
                                    <label class="flex items-center gap-4">
                                        <input type="checkbox" id="use-cohere" checked class="form-checkbox">
                                        <span class="font-medium">Use AI for enhanced analysis</span>
                                    </label>
                                    <label class="flex items-center gap-4">
                                        <input type="checkbox" id="detailed-analysis" checked class="form-checkbox">
                                        <span class="font-medium">Generate detailed analysis</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Report Options</h3>
                            </div>
                            <div class="card-body">
                                <div class="space-y-6">
                                    <label class="flex items-center gap-4">
                                        <input type="checkbox" id="include-alternatives" checked class="form-checkbox">
                                        <span class="font-medium">Include alternative drug recommendations</span>
                                    </label>
                                    <label class="flex items-center gap-4">
                                        <input type="checkbox" id="include-references" checked class="form-checkbox">
                                        <span class="font-medium">Include scientific references</span>
                                    </label>
                                    <label class="flex items-center gap-4">
                                        <input type="checkbox" id="patient-friendly" checked class="form-checkbox">
                                        <span class="font-medium">Generate patient-friendly summary</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-actions">
                        <button class="btn btn-secondary btn-lg" onclick="previousStep(3)">
                            <i class="fas fa-arrow-left"></i>
                            Previous
                        </button>
                        <button class="btn btn-primary btn-lg" onclick="startAnalysis()">
                            <i class="fas fa-play"></i>
                            Start Analysis
                        </button>
                    </div>
                </div>

                <!-- Analysis Progress -->
                <div id="analysis-progress" class="progress-container" style="display: none;">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl font-bold text-red mb-4">Analysis in Progress</h2>
                        <p class="text-secondary text-lg">Please wait while we process your genetic data</p>
                    </div>
                    
                    <div class="progress-steps">
                        <div class="progress-step completed">
                            <div class="progress-step-icon">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="progress-step-label">File Upload</div>
                        </div>
                        <div class="progress-step active">
                            <div class="progress-step-icon">
                                <i class="fas fa-cog fa-spin"></i>
                            </div>
                            <div class="progress-step-label">Processing</div>
                        </div>
                        <div class="progress-step">
                            <div class="progress-step-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="progress-step-label">Analysis</div>
                        </div>
                        <div class="progress-step">
                            <div class="progress-step-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="progress-step-label">Report</div>
                        </div>
                    </div>

                    <div class="mt-12 text-center">
                        <div id="progress-text" class="font-semibold text-xl mb-3">Initializing analysis...</div>
                        <div id="progress-details" class="text-secondary text-lg">Please wait while we process your data</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="content-section">
            <div class="section-header">
                <h1>Analysis Reports</h1>
                <p>View and manage your pharmacogenomics analysis reports</p>
            </div>

            <div class="card mb-12">
                <div class="card-body">
                    <div class="flex justify-between items-center gap-6 flex-wrap">
                        <div class="flex gap-4 flex-wrap">
                            <input type="text" id="report-search" class="form-input" placeholder="Search reports..." style="min-width: 300px;">
                            <select id="report-filter" class="form-select">
                                <option value="all">All Reports</option>
                                <option value="recent">Recent (30 days)</option>
                                <option value="high-risk">High Risk</option>
                                <option value="completed">Completed</option>
                                <option value="processing">Processing</option>
                            </select>
                        </div>
                        <div class="flex gap-3">
                            <button class="btn btn-sm btn-primary" data-view="grid">
                                <i class="fas fa-th"></i>
                                Grid
                            </button>
                            <button class="btn btn-sm btn-outline" data-view="list">
                                <i class="fas fa-list"></i>
                                List
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="reports-container" class="reports-grid">
                <!-- Reports will be populated here -->
            </div>
        </section>

        <!-- Drug Database Section -->
        <section id="drugs" class="content-section">
            <div class="section-header">
                <h1>Drug Database</h1>
                <p>Browse pharmacogenomics information for various medications</p>
            </div>

            <div class="card mb-12">
                <div class="card-body">
                    <div class="flex gap-4 flex-wrap">
                        <input type="text" id="drug-db-search" class="form-input" placeholder="Search drugs..." style="min-width: 300px;">
                        <select id="drug-category-filter" class="form-select">
                            <option value="all">All Categories</option>
                            <option value="cardiovascular">Cardiovascular</option>
                            <option value="psychiatric">Psychiatric</option>
                            <option value="oncology">Oncology</option>
                            <option value="pain">Pain Management</option>
                            <option value="other">Other</option>
                        </select>
                        <select id="drug-evidence-filter" class="form-select">
                            <option value="all">All Evidence Levels</option>
                            <option value="high">High Evidence</option>
                            <option value="medium">Medium Evidence</option>
                            <option value="low">Low Evidence</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="drug-database-grid" class="reports-grid">
                <!-- Drug cards will be populated here -->
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="content-section">
            <div class="section-header">
                <h1>Settings</h1>
                <p>Configure your application preferences and API settings</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">API Configuration</h2>
                        <p class="card-subtitle">Configure backend connection settings</p>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label" for="api-endpoint">API Endpoint</label>
                            <input type="text" id="api-endpoint" class="form-input" value="http://localhost:8000" placeholder="Enter API endpoint URL">
                        </div>
                        <button class="btn btn-primary btn-lg" onclick="testConnection()">
                            <i class="fas fa-wifi"></i>
                            Test Connection
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Analysis Preferences</h2>
                        <p class="card-subtitle">Set default analysis options</p>
                    </div>
                    <div class="card-body">
                        <div class="space-y-6">
                            <div class="flex justify-between items-center">
                                <label class="font-medium">Enable AI Analysis by Default</label>
                                <input type="checkbox" id="default-ai-analysis" checked class="form-checkbox">
                            </div>
                            <div class="flex justify-between items-center">
                                <label class="font-medium">Include References by Default</label>
                                <input type="checkbox" id="default-references" checked class="form-checkbox">
                            </div>
                            <div class="flex justify-between items-center">
                                <label class="font-medium">Patient-Friendly Reports</label>
                                <input type="checkbox" id="default-patient-friendly" checked class="form-checkbox">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card lg:col-span-2">
                    <div class="card-header">
                        <h2 class="card-title">Data Management</h2>
                        <p class="card-subtitle">Manage your stored data and reports</p>
                    </div>
                    <div class="card-body">
                        <div class="flex gap-4 flex-wrap">
                            <button class="btn btn-secondary btn-lg" onclick="exportAllData()">
                                <i class="fas fa-download"></i>
                                Export All Data
                            </button>
                            <button class="btn btn-outline btn-lg" onclick="clearAllData()" style="border-color: var(--primary-red); color: var(--primary-red);">
                                <i class="fas fa-trash"></i>
                                Clear All Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <!-- Report Modal -->
    <div id="report-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-report-title" class="modal-title">Report Details</h2>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="modal-report-content">
                    <!-- Report content will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('report-modal')">Close</button>
                <button class="btn btn-primary">Download Report</button>
            </div>
        </div>
    </div>

    <!-- Drug Modal -->
    <div id="drug-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-drug-title" class="modal-title">Drug Information</h2>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="modal-drug-content">
                    <!-- Drug content will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('drug-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Analysis Complete Modal -->
    <div id="analysis-complete-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-analysis-complete-title" class="modal-title">Analysis Completed!</h2>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="modal-analysis-complete-content">
                    <!-- Analysis complete content will be populated here -->
                </div>
                
                <div class="detail-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                    <h3 style="margin-bottom: 1rem; color: var(--primary-red);">🎉 Where would you like to go next?</h3>
                    <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
                        Your analysis report has been generated successfully. Choose where you'd like to go:
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <button class="btn btn-outline btn-lg" data-action="dashboard" onclick="handleAnalysisCompleteModal(event)" style="display: flex; flex-direction: column; align-items: center; padding: 1.5rem; height: auto;">
                            <i class="fas fa-home" style="font-size: 2rem; margin-bottom: 0.5rem; color: var(--primary-red);"></i>
                            <span style="font-weight: 600; margin-bottom: 0.25rem;">Dashboard</span>
                            <span style="font-size: 0.875rem; color: var(--text-secondary); text-align: center;">View overview and statistics</span>
                        </button>
                        
                        <button class="btn btn-primary btn-lg" data-action="reports" onclick="handleAnalysisCompleteModal(event)" style="display: flex; flex-direction: column; align-items: center; padding: 1.5rem; height: auto;">
                            <i class="fas fa-file-medical" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                            <span style="font-weight: 600; margin-bottom: 0.25rem;">Reports</span>
                            <span style="font-size: 0.875rem; color: rgba(255,255,255,0.8); text-align: center;">View your analysis report</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="loading-spinner-icon">
                <i class="fas fa-spinner fa-spin"></i>
            </div>
            <div class="loading-text">Processing...</div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container">
        <!-- Toast notifications will appear here -->
    </div>

    <script src="script.js"></script>
</body>
</html>
